<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" 
	xmlns:n="http://ntua/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition template="/templates/super.xhtml">
	
	<ui:define name="head">
        <script type="text/javascript"
                src="http://maps.google.com/maps/api/js?key=AIzaSyDgwKpTAu0MFK-0Y35YEGVCIthTTKXLpaE"/>
        <script type="text/javascript">
		$(document).on('dblclick',
		        '.ui-diagram > .ui-diagram-element',
		        function(info) {
		            elementClicked([ {
		                name : 'elementId',
		                value : info.target.id
		            } ]);
		        });
		</script>
    </ui:define>
    

	<ui:define name="content">

		<p:panel id="relation_search_panel" toggleSpeed="500" toggleable="true" widgetVar="panel" 
			styleClass="searchPanel">
			<p:messages />
			<h:panelGrid columns="3" id="criteria">
				<h:panelGrid columns="2">
					
					<n:input label="Phone number" required="true"
						value="#{relationFinderController.searchCriteria.phoneNumber}">
						<ui:define name="extra">
							<p:ajax event="change" update="criteria"/>
						</ui:define>
					</n:input>
					
					<n:input label="Other Phone number" 
						disabled="#{empty relationFinderController.searchCriteria.phoneNumber}"
						value="#{relationFinderController.searchCriteria.externalPhoneNumber}"/>
									
				</h:panelGrid>
				
				<h:panelGrid columns="2">
					
					<n:calendar label="Date from" value="#{relationFinderController.searchCriteria.dateFrom}"
						type="dateTime" />
					
					<n:calendar label="Date to" value="#{relationFinderController.searchCriteria.dateTo}"
						type="dateTime"/>
				
				</h:panelGrid>
				
			</h:panelGrid>
			<p:commandButton id="doValidateAndSearch" value="Search" update="relation_results_panel"
				action="#{relationFinderController.search()}" oncomplete="PF('panel').toggle()"/>
				
			<p:commandButton value="Reset" update="relation_search_panel relation_results_panel"
				action="#{relationFinderController.reset()}" />
			
			<f:facet name="header">
				<p:outputLabel style="width:100%; text-align:center" value="Search Criteria" onclick="PF('panel').toggle()"/>
	        </f:facet>
				
		</p:panel>
		
		<h:panelGrid id="relation_results_panel" columns="1" style="margin-top:60px; z-index:1"
			columnClasses="map_panel_left" width="100%">
			
			<p:diagram id="relationDiagram" value="#{relationFinderController.model}" style="height:600px" 
				styleClass="ui-widget-content" rendered="#{not empty relationFinderController.model}" />
		    
		    <p:remoteCommand name="elementClicked" update="relation_results_panel"
                actionListener="#{relationFinderController.onElementClicked}"/>
                
            
	    </h:panelGrid>
        
	</ui:define>
</ui:composition>
</html>